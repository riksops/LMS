name: Pull Request Orchestration

on:
  workflow_call:

jobs:
  build:
    uses: ./.github/workflows/npm_build_and_test.yaml
    secrets: inherit

  sonarqube:
    needs: [build]
    if: ${{ needs.job.build.outputs.coverage == 'true' }}
    uses: ./.github/workflows/common_sonarqube.yaml
    secrets: inherit

  notify_user_on_failure:
    needs: [sonarqube]
    if: failure()
    uses: ./.github/workflows/common_send_notification.yaml
    with:
      message: "Build failed for repository ${{ github.repository }}"
    secrets: inherit

  notify_user_on_success:
    needs: [sonarqube]
    if: success()
    uses: ./.github/workflows/common_send_notification.yaml
    with:
      message: "Build passed for repository ${{ github.repository }}"
    secrets: inherit